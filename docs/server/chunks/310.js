"use strict";exports.id=310,exports.ids=[310],exports.modules={50310:(e,t,r)=>{r.r(t),r.d(t,{MfaAuthVerifyFlowScreen:()=>n,default:()=>n});var s=r(45512),o=r(58009),a=r(37782),i=r(91468);r(5327),r(7623),r(61889),r(25998),r(88527);let n={component:()=>{let{user:e}=(0,a.u)(),{data:t}=(0,a.a)(),[r,n]=(0,o.useState)(e?.mfaMethods[0]),[c,l]=(0,o.useState)(!1),[f,d]=(0,o.useState)(),[u,h]=(0,o.useState)();if((0,o.useEffect)(()=>{n(e?.mfaMethods[0])},[e?.mfaMethods]),!t?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:m,onSuccess:y,generateOptions:p,verifyTotpCode:v,verifyPasskey:k,verifySmsCode:w,sendSmsCode:S}=t.mfaVerify,g=async e=>{if("passkey"!==e)try{n(e),"sms"===e&&(n(e),await S()),"totp"===e&&n(e)}catch(e){console.error(e)}else try{n(e);let t=await p();if(!t)throw Error("something went wrong");d(t),await k(t),l(!0),h(void 0),y()}catch(e){h((0,i.t)(e))}},M=async e=>{h(void 0);try{if(!e||!r)return;if("passkey"===r){if(!f)throw Error("Missing passkey challenge");await k(f)}else"sms"===r?await w(e):"totp"===r&&await v(e);h(void 0),l(!0),y()}catch(e){throw(0,i.t)(e).error}},C=()=>{u||!c?m(u?.error??Error("Canceled MFA verification.")):y()},E=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{!E.current&&r&&(E.current=!0,g(r).finally(()=>{E.current=!1}))},[open]),e?"passkey"===r?(0,s.jsx)(i.V,{account:e.linkedAccounts.filter(e=>"passkey"===e.type&&e.enrolledInMfa).sort((e,t)=>t.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf())[0],submitSuccess:c,hasBlockingError:u?.isBlocking??!1,error:u?.error,onClose:C,onBack:()=>{n(void 0),h(void 0)},handleSubmit:()=>M(f).catch(h)}):"sms"===r||"totp"===r?(0,s.jsx)(i.a,{selectedMethod:r,submitSuccess:c,hasBlockingError:u?.isBlocking??!1,handleSubmitCode:M,onClose:C,onBack:e.mfaMethods.length>1?()=>n(void 0):void 0}):(0,s.jsx)(i.b,{user:e,onSelect:g,handleClose:C}):null}}}};