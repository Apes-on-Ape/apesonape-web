"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3791],{3791:(e,t,l)=>{l.r(t),l.d(t,{default:()=>c});var r=l(95155),a=l(12115),i=l(48173),n=l.n(i),s=l(21833),u=l(45687),o=l(77674);function c(){let{login:e,logout:t,user:l,isAuthenticated:i}=(0,s.j)(),c=(0,u.u)().user,{checkTokenGate:d,isTokenGateLoading:f}=(0,s.n)(),[h,p]=(0,a.useState)(!1),m=(0,a.useCallback)(async()=>{p(!0);try{let e=!1;for(let t=0;t<8;t++){let t=await d({contractAddress:"0xa6babe18f2318d2880dd7da3126c19536048f8b0",includeDelegates:!0,chainId:33139});if(null==t?void 0:t.result){e=!0;break}await new Promise(e=>setTimeout(e,750))}return e}finally{p(!1)}},[d]),v=async()=>{try{await (null==e?void 0:e()),await m()||await (null==t?void 0:t())}catch(e){}},w=!!l||!!i;(0,a.useEffect)(()=>{w&&c&&(async()=>{try{let e=c.id,t=c.twitter;if(!e)return;await fetch("/api/auth/init-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,displayName:(null==t?void 0:t.name)||null,xUsername:(null==t?void 0:t.username)||null,avatarUrl:(null==t?void 0:t.profilePictureUrl)||null})})}catch(e){console.error("Error initializing user:",e)}})()},[w,c]);let[y,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{w&&c&&(async()=>{try{let t=c.id;if(!t)return;let l=await fetch("/api/profile/summary?userId=".concat(encodeURIComponent(t)));if(l.ok){var e;let t=await l.json();(null==t?void 0:null===(e=t.profile)||void 0===e?void 0:e.avatar_url)&&b(t.profile.avatar_url)}}catch(e){console.error("Error fetching avatar:",e)}})()},[w,c]);let j=(0,a.useMemo)(()=>{if(y)return y;let e=(null==c?void 0:c.twitter)||null;return(null==e?void 0:e.profilePictureUrl)||null},[y,c]);return w?(0,r.jsx)(n(),{href:"/profile",className:"inline-flex items-center justify-center",children:j?(0,r.jsx)(o.default,{src:j,alt:"Profile",width:64,height:64,className:"w-8 h-8 rounded-full border border-white/20 object-cover"}):(0,r.jsx)("div",{className:"w-8 h-8 rounded-full border border-white/20 bg-black/30"})}):(0,r.jsx)("button",{onClick:()=>{v()},className:"btn-primary px-3 py-1.5 text-sm",disabled:f||h,children:"Sign in"})}},77674:(e,t,l)=>{l.d(t,{default:()=>i});var r=l(95155),a=l(5565);function i(e){let{src:t,alt:l,className:i,width:n=800,height:s=800,fill:u=!1,sizes:o="100vw",unoptimized:c=!0,priority:d=!1}=e,f=t||"/placeholder.png";return u?(0,r.jsx)(a.default,{src:f,alt:l,fill:!0,sizes:o,unoptimized:c,className:i,priority:d}):(0,r.jsx)(a.default,{src:f,alt:l,width:n,height:s,sizes:o,unoptimized:c,className:i,priority:d})}l(12115)}}]);