"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9314],{69314:(e,n,a)=>{a.r(n),a.d(n,{AwaitingSolToEvmBridgingScreen:()=>b,default:()=>b});var t=a(95155),r=a(14826),s=a(12115),o=a(37455),i=a(32789),d=a(59242),l=a(40639),c=a(86777),u=a(25202),g=a(78584),f=a(81084),h=a(31679),p=a(48568),m=a(5944),w=a(67526),v=a(73899),S=a(45687),T=a(65310),C=a(84739);a(68943),a(47147),a(29761);let b={component:function(){let e=(0,f.u)(),{closePrivyModal:n,createAnalyticsEvent:a,connectors:b}=(0,h.u)(),{navigate:I,setModalData:y,data:A}=(0,m.a)(),N=(0,f.u)(),E=(0,s.useRef)(!1),x=(0,S.a)(),[F,U]=(0,s.useState)(!1),[j,R]=(0,s.useState)(!1),[k,W]=(0,s.useState)(null),[_,B]=(0,s.useState)(),[D,$]=(0,s.useState)();if(!A?.funding||"ethereum"!==A.funding.chainType)throw Error("Invalid funding data");let{amount:L,connectedWallet:P,chain:M,solanaChain:O,isUSDC:q}=A.funding,H=A.funding.address,Q=A.funding.erc20Address,V=A.funding.isUSDC?"USDC":M.nativeCurrency.symbol,Y=(0,s.useMemo)(()=>"solana"===P?.type?P.provider:function({connectors:e,connectedWalletAddress:n}){let a=e.find(e=>"solana"===e.chainType&&e.wallets.some(e=>e.address===n)),t=a?.wallet.accounts.find(e=>e.address===n);if(!a||!t)throw new h.a("Unable to find source wallet connector");return new i.W({wallet:a.wallet,account:t})}({connectors:b,connectedWalletAddress:P?.address||""}),[P,b]),z=(0,s.useMemo)(()=>{let n=x(S.S);if(!n)throw new h.a("Unable to load solana plugin");let a=e.solanaRpcs["solana:mainnet"];if(!a)throw new h.a("Unable to load mainnet RPC");return n.getSolanaRpcClient({rpc:a.rpc,rpcSubscriptions:a.rpcSubscriptions,chain:"solana:mainnet",blockExplorerUrl:a.blockExplorerUrl??"https://explorer.solana.com"})},[]),G=(0,p.Q)((0,C.t)(Y?.standardWallet.name||"unknown")),J=G?.name||"wallet";return(0,s.useEffect)(()=>{(async function(){if(!Y||!M||E.current)return;let e=x(S.S);if(!e)return void W(new h.a("Unable to solana plugin"));E.current=!0,M?.testnet&&console.warn("Solana testnets are not supported for bridging");let n=q?1e6*parseFloat(L):(0,o.g)(L),a=await (0,v.g)({isTestnet:!!M.testnet,input:(0,v.t)({appId:N.id,amount:n.toString(),user:Y.address,recipient:H,destinationChainId:M.id,originChainId:v.b,originCurrency:q?v.d:v.a,destinationCurrency:q?Q:void 0})}).catch(console.error);if(!a)return void W(new h.a(`Unable to fetch quotes for bridging. Wallet ${(0,p.a6)(Y.address)} does not have enough funds.`,void 0,h.b.INSUFFICIENT_BALANCE));let t=await e.createTransactionFromRelayQuote({quote:a,source:Y.address,solanaClient:z});if(t)try{U(!0);let n=await e.simulateTransaction({solanaClient:z,tx:t});if(n.hasError)return n.hasFunds?(console.error("Transaction failed:",n.error),void W(new h.a("Something went wrong",void 0,h.b.TRANSACTION_FAILURE))):void W(new h.a(`Wallet ${(0,p.a6)(Y?.address)} does not have enough funds. ${a.details.currencyIn.amountFormatted} ${V} are needed to complete the transaction.`,void 0,h.b.INSUFFICIENT_BALANCE));let{signature:r}=await Y.signAndSendTransaction({chain:"solana:mainnet",transaction:t}),s=e.getAddressFromBuffer(r);B(s),$("pending")}catch(e){if(console.error(e),/user rejected the request/gi.test(e.message||""))return void W(new h.a("Transaction was rejected by the user",void 0,h.b.TRANSACTION_FAILURE));W(new h.a("Something went wrong",void 0,h.b.TRANSACTION_FAILURE))}else W(new h.a(`Unable to select bridge option from quotes. Wallet ${(0,p.a6)(Y.address)} does not have enough funds.`,void 0,h.b.INSUFFICIENT_BALANCE))})().catch(console.error)},[]),(0,v.u)({transactionHash:_,isTestnet:!1,bridgingStatus:D,setBridgingStatus:$,onSuccess({transactionHash:e}){U(!1),R(!0),a({eventName:w.O,payload:{provider:"external",status:"success",txHash:e,address:Y.address,chainType:"solana",clusterName:O,token:"SOL",destinationAddress:H,destinationChainId:M.id,destinationChainType:"ethereum",destinationValue:L,destinationToken:q?"USDC":"ETH"}})},onFailure({error:e}){U(!1),W(e)}}),(0,s.useEffect)(()=>{if(!j)return;let e=setTimeout(n,f.t);return()=>clearTimeout(e)},[j]),(0,s.useEffect)(()=>{k&&(y({funding:A?.funding,solanaFundingData:A?.solanaFundingData,sendTransaction:A?.sendTransaction,errorModalData:{error:k,previousScreen:"TransferFromWalletScreen"}}),I("ErrorScreen",!1))},[k]),j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.t,{}),(0,t.jsx)(d.b,{}),(0,t.jsxs)(d.c,{children:[(0,t.jsx)(r.A,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),(0,t.jsx)(c.C,{title:"Success!",description:`Youâ€™ve successfully added ${L} ${V} to your ${N.name} wallet. It may take a minute before the funds are available to use.`})]}),(0,t.jsx)(d.R,{}),(0,t.jsx)(l.B,{})]}):F&&Y?(0,t.jsx)(T.T,{walletClientType:(0,C.t)(Y?.standardWallet.name||"unknown"),displayName:J,addressToFund:H,isBridging:F,isErc20Flow:!1,chainId:M.id,chainName:M.name,totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.t,{}),(0,t.jsx)(g.N,{}),(0,t.jsx)("div",{style:{marginTop:"1rem"}}),(0,t.jsx)(l.B,{})]})}}}}]);